(()=>{"use strict";function e(e){e.remove()}function t(e,t){t?e.classList.add("card__like-button_is-active"):e.classList.remove("card__like-button_is-active")}function n(e,t,n){n.textContent=e}function o(e){e.classList.remove("popup_is-opened"),e.removeEventListener("mousedown",c),document.removeEventListener("keydown",u)}function r(e){e.classList.add("popup_is-opened"),e.addEventListener("mousedown",c),document.addEventListener("keydown",u)}function c(e){e.target===e.currentTarget&&o(e.target)}function u(e){var t=document.querySelector(".popup_is-opened");"Escape"==e.key&&o(t)}var a=function(e,t,n,o){e.classList.remove(t),n.textContent="",n.classList.remove(o)},i=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))};function s(e,t,n,o,r,c){var u=Array.from(e.querySelectorAll(t)),s=e.querySelector(n);u.forEach((function(t){var n=e.querySelector(".".concat(t.id,"-error"));a(t,r,n,c)})),i(u,s,o)}var p={baseUrl:"https://nomoreparties.co/v1/wff-cohort-27",headers:{authorization:"218cd896-e761-498d-89f7-9c5fe951097b","Content-Type":"application/json"}};function l(e){return fetch("".concat(p.baseUrl,"/cards/").concat(e),{headers:p.headers,method:"DELETE"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}var d,_=document.querySelector(".popup_type_image"),f=_.querySelector(".popup__image"),m=_.querySelector(".popup__caption"),v=document.querySelector(".places__list"),y=document.querySelector("#card-template").content;function h(e,t){e.textContent=t?"Сохранение...":"Сохранить"}function b(e){var t=!1,n=e.likes;return null!=e.likes&&n.forEach((function(e){e._id===d&&(t=!0)})),t}function S(e,o,r,c){var u=function(e){return!!e.classList.contains("card__like-button_is-active")}(o);u?function(e){return fetch("".concat(p.baseUrl,"/cards/likes/").concat(e),{headers:p.headers,method:"DELETE"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(e){t(o,!1),n(e.likes.length,0,c)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(p.baseUrl,"/cards/likes/").concat(e),{headers:p.headers,method:"PUT"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(e){t(o,!0),n(e.likes.length,0,c)})).catch((function(e){console.log(e)}))}function q(o,r,c,u,a,i,s){var p=function(e,o,r,c,u,a,i,s,p,l,d){var _=c.querySelector(".card").cloneNode(!0),f=_.querySelector(".card__like-button"),m=_.querySelector(".card__like-button-counter");t(f,d),n(a,0,m);var v=_.querySelector(".card__image"),y=_.querySelector(".card__title");v.src=e,y.textContent=o;var h=_.querySelector(".card__delete-button");return h.addEventListener("click",(function(){return r(_)})),h.addEventListener("click",(function(){return s(p)})),f.addEventListener("click",(function(){return l(p,f,_,m)})),v.addEventListener("click",(function(){return u(e,o)})),i&&h.classList.add("active_card_delete-button"),_}(r,o,e,y,F,u,a===d,l,i,S,s);c?v.prepend(p):v.append(p)}var k=document.querySelector(".popup__input_type_name"),L=document.querySelector(".popup__input_type_description"),g=document.querySelector(".popup__input_type_update-avatar"),E=document.querySelector(".profile__image"),j=document.querySelector(".profile__title"),P=document.querySelector(".profile__description");function C(e,t,n){j.textContent=e,P.textContent=t,E.style.backgroundImage="url(".concat(n,")")}var T=document.querySelector(".profile__edit-button"),U=document.querySelector(".popup_type_edit");T.addEventListener("click",(function(e){k.value=j.innerHTML,L.value=P.innerHTML,s(U.querySelector(".popup__form"),".popup__input",".popup__button","popup__button_disabled","popup__input_type_error","popup__error_visible"),r(U),e.stopImmediatePropagation()}));var w=document.querySelector(".profile__add-button"),A=document.querySelector(".popup_type_new-card");w.addEventListener("click",(function(e){s(A.querySelector(".popup__form"),".popup__input",".popup__button","popup__button_disabled","popup__input_type_error","popup__error_visible"),r(A),e.stopImmediatePropagation()}));var x=document.querySelector(".profile__image-button"),D=document.querySelector(".popup_type_update-avatar");x.addEventListener("click",(function(e){s(D.querySelector(".popup__form"),".popup__input",".popup__button","popup__button_disabled","popup__input_type_error","popup__error_visible"),r(D),e.stopImmediatePropagation()}));var I=document.forms["update-avatar"],M=I.querySelector(".popup__button");function H(e){o(e.target.closest(".popup"))}I.addEventListener("submit",(function(e){h(M,!0),e.preventDefault(),function(e){return fetch("".concat(p.baseUrl,"/users/me/avatar"),{headers:p.headers,method:"PATCH",body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(g.value).then((function(){E.style.backgroundImage="url(".concat(g.value,")")})).catch((function(e){console.log(e)})).finally((function(){h(M,!0)}))})),I.addEventListener("submit",(function(){return o(D)})),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",H)}));var N=document.forms["edit-profile"],O=N.querySelector(".popup__button");N.addEventListener("submit",(function(e){var t,n;h(O,!0),e.preventDefault(),(t=k.value,n=L.value,console.log(t),console.log(n),fetch("".concat(p.baseUrl,"/users/me"),{headers:p.headers,method:"PATCH",body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){C(e.name,e.about,e.avatar)})).catch((function(e){console.log(e)})).finally((function(){h(O,!1)}))})),N.addEventListener("submit",(function(){return o(U)}));var J=document.forms["new-place"],V=document.querySelector(".popup__input_type_card-name"),z=document.querySelector(".popup__input_type_url"),B=J.querySelector(".popup__button");function F(e,t){r(_),f.src=e,f.alt=t,m.textContent=t}J.addEventListener("submit",(function(e){var t,n;h(B,!0),e.preventDefault(),(t=V.value,n=z.value,fetch("".concat(p.baseUrl,"/cards"),{headers:p.headers,method:"POST",body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){q(e.name,e.link,!0,e.likes.length,e.owner._id,e._id,b(e))})).catch((function(e){console.log(e)})).finally((function(){h(B,!1)}))})),J.addEventListener("submit",(function(){return o(A)})),J.addEventListener("submit",(function(){return J.reset()})),fetch("".concat(p.baseUrl,"/users/me "),{headers:p.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){C(e.name,e.about,e.avatar),d=e._id})).catch((function(e){console.log(e)})),fetch("".concat(p.baseUrl,"/cards"),{headers:p.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){q(e.name,e.link,!1,e.likes.length,e.owner._id,e._id,b(e))}))})).catch((function(e){console.log(e)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e,t,n,o,r,c){var u=Array.from(e.querySelectorAll(t)),s=e.querySelector(r);i(u,s,c),u.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity("");var r=n.querySelector(".".concat(e.id,"-error"));e.validity.valid?a(e,t,r,o):function(e,t,n,o,r){o.textContent=t,e.classList.add(n),o.classList.add(r)}(e,e.validationMessage,t,r,o)}(t,n,e,o),i(u,s,c)}))}))}(e,".popup__input","popup__input_type_error","popup__error_visible",".popup__button","popup__button_disabled")}))})();